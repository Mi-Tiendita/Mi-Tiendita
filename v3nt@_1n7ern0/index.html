<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Venta Masiva</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/img/icon-192.png" type="image/png">
    <link rel="apple-touch-icon" href="/img/icon-512.png" sizes="512x512">
    <style>
        :root {
            --azul: #0d1c84;
            --gris: #f4f6fb;
            --sombra: 0 2px 8px rgba(0, 0, 0, .1);
            --radio: 8px;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        html,
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            max-width: 100%;
            overflow-x: hidden;
            width: 100%;
            background: var(--gris)
        }

        header {
            background: var(--azul);
            color: #fff;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 20px
        }

        .req {
            color: red;
            font-weight: bold;
        }

        header img {
            height: 80px;
            border-radius: 50%;
            border: 3px solid #fff;
            background-color: #0d1c84;
        }

        .contenido {
            padding: 20px
        }

        .card {
            background: #fff;
            padding: 20px;
            border-radius: var(--radio);
            box-shadow: var(--sombra);
            margin-bottom: 20px
        }

        h2 {
            margin: 0 0 12px;
            color: var(--azul);
            font-weight: 700;
            text-align: left
        }

        .modal-actions.center {
            justify-content: center;
            gap: 20px;
        }

        .empleado-view {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px
        }

        .empleado-item {
            background: #f8f9ff;
            border: 1px solid #e4e8ff;
            border-radius: 10px;
            padding: 10px
        }

        .empleado-item b {
            display: block;
            color: #222;
            margin-bottom: 4px
        }

        .empleado-item span {
            color: #333
        }

        label {
            display: block;
            margin: 8px 0 4px
        }

        input[type="text"],
        input[type="tel"] {
            width: 100%;
            padding: 10px;
            border-radius: var(--radio);
            border: 1px solid #cfd2d9
        }

        .error {
            border: 2px solid red !important
        }

        .producto {
            display: flex;
            gap: 14px;
            margin-bottom: 15px;
            border: 1px solid #dfe3ea;
            border-radius: var(--radio);
            padding: 14px;
            align-items: center
        }

        .producto img {
            max-width: 180px;
            border-radius: var(--radio)
        }

        .producto-info {
            flex: 1
        }

        .producto-titulo {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap
        }

        .numero-producto {
            background: #eef2ff;
            color: #223;
            min-width: 46px;
            height: 46px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            font-weight: 700
        }

        .badge-agotado {
            display: inline-block;
            background: #eee;
            color: #666;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            margin-left: 8px
        }

        .radios label {
            margin-right: 10px
        }

        #btnEnviar {
            padding: 12px 22px;
            background: var(--azul);
            color: #fff;
            border: none;
            border-radius: var(--radio);
            cursor: pointer;
            font-size: 16px
        }

        footer.pie {
            background: var(--azul);
            color: #fff;
            padding: 15px;
            text-align: center
        }

        footer a {
            color: #fff;
            text-decoration: underline
        }

        .total {
            font-weight: 800;
            text-align: right;
            margin-top: 12px;
            font-size: 22px
        }

        .total .label {
            color: var(--azul);
        }

        .total .amount {
            color: #000;
        }

        .numero-producto-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-weight: bold;
        }

        .item-label {
            font-size: 12px;
            color: black;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 16px;
            overflow-x: hidden;
        }

        .modal-content {
            background: #fff;
            width: min(520px, 92vw);
            max-width: 520px;
            padding: 24px 28px;
            border-radius: var(--radio);
            max-height: 82vh;
            overflow-y: auto;
            overflow-x: hidden;
        }

        #modalEmpleado input[type="text"],
        #modalEmpleado input[type="tel"] {
            width: 100%;
            margin-bottom: 12px;
        }

        #modalEmpleado .modal-actions {
            justify-content: center;
        }

        #modalEmpleado {
            background: rgba(0, 0, 0, .6);
        }

        #modalEmpleado .modal-content {
            border: 5px solid var(--azul);
            border-radius: 10px;
            box-shadow: 0 0 12px rgba(13, 28, 132, 0.6);
        }

        #modalConfirmacion .modal-content {
            border: 5px solid var(--azul);
            border-radius: 10px;
            box-shadow: 0 0 12px rgba(13, 28, 132, 0.6);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: auto;
            word-wrap: break-word;
            white-space: normal;
        }

        #modalPreConfirm .modal-content {
            width: auto;
            max-width: 320px;
            min-width: 280px;
            padding: 18px 20px;
            text-align: center;
            margin: 0 auto;

            border: 3px solid #FFD700;
            border-radius: 10px;
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.6);
        }

        #modalConfirmacion .linea b {
            color: black;
            font-weight: 700;
        }

        #modalConfirmacion .quitar {
            background: #c10d0d;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 4px 10px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s ease;
        }

        #modalConfirmacion .quitar:hover {
            background: #a30808;
        }

        html.modal-open,
        body.modal-open {
            overflow: hidden;
            height: 100%;
            overscroll-behavior: contain;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 14px
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700
        }

        .btn-gray {
            background: #7a7a7a;
            color: #fff
        }

        .btn-green {
            background: #0f8f2e;
            color: #fff
        }

        .btn-red {
            background: #c10d0d;
            color: #fff
        }

        .btn-blue {
            background: var(--azul);
            color: #fff
        }

        .linea {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 6px 0;
            border-bottom: 1px dashed #eee
        }

        .linea small {
            color: #444
        }

        .quitar {
            background: #eee;
            color: #333;
            border-radius: 6px;
            padding: 4px 8px;
            cursor: pointer
        }

        .banner {
            max-width: 920px;
            margin: 14px auto 0;
            padding: 10px 14px;
            border-radius: 10px
        }

        .banner.info {
            background: #eef6ff;
            color: #063c76;
            border: 1px solid #cfe3ff
        }

        .banner.warn {
            background: #fff4e5;
            color: #7a3e00;
            border: 1px solid #ffd9a8
        }

        .banner.error {
            background: #ffecec;
            color: #7a0000;
            border: 1px solid #ffb3b3
        }

        .timer {
            font-weight: 700
        }

        .timer-float {
            position: fixed;
            right: 12px;
            top: 20%;
            z-index: 1100;
            display: none
        }

        .timer-box {
            background: #0d1c84;
            color: #fff;
            padding: 10px 14px;
            border-radius: 12px;
            box-shadow: 0 4px 14px rgba(0, 0, 0, .2);
            min-width: 170px;
            text-align: center;
            font-weight: 700
        }

        .timer-box small {
            display: block;
            font-weight: 400;
            opacity: .9
        }

        .confirm-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 14px;
            align-items: start;
            position: relative;
        }

        .folio-box {
            position: absolute;
            top: 45px;
            right: 20px;
            background: #f0f3ff;
            border: 1px solid #cfd7ff;
            border-radius: 12px;
            padding: 12px 16px;
            min-width: 180px;
            text-align: center;
        }

        #totalPopup {
            text-align: left !important;
            margin-top: 12px;
            font-weight: 800;
            font-size: 22px;
        }

        .folio-box b {
            display: block;
            color: #222
        }

        .folio-num {
            font-size: 28px;
            font-weight: 900;
            color: #0d1c84
        }

        @media(max-width:600px) {
            .timer-float {
                right: 0;
                left: 0;
                top: auto;
                bottom: 10px;
                display: none
            }

            .timer-box {
                margin: 0 auto;
                border-radius: 999px
            }

            .producto {
                flex-direction: column;
                align-items: center
            }

            .producto img {
                max-width: 100%
            }

            .confirm-grid {
                grid-template-columns: 1fr
            }

            .folio-box {
                order: -1
            }
        }
    </style>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>

<body>
    <header>
        <img src="/img/sitelogo.png" alt="MiTiendita" />
        <h1>Venta Masiva Noviembre 2025</h1>
    </header>

    <div id="bannerEstado" class="banner info" style="display:none"></div>

    <div id="timerFloat" class="timer-float">
        <div class="timer-box">
            <small>Tiempo restante</small>
            <span id="timerFloatText">10:00</span>
        </div>
    </div>

    <main class="contenido">
        <section class="card" id="infoEmpleadoCard">
            <h2><b>Información del Empleado</b></h2>
            <div class="empleado-view">
                <div class="empleado-item">
                    <b>Nómina</b>
                    <span id="vNomina">—</span>
                </div>
                <div class="empleado-item">
                    <b>Nombre</b>
                    <span id="vNombre">—</span>
                </div>
                <div class="empleado-item">
                    <b>Celular</b>
                    <span id="vCelular">—</span>
                </div>
            </div>
            <div id="cuentaRegresiva" class="timer" style="display:none;margin-top:8px;"></div>
        </section>

        <section class="card" id="catalogoProductos">
            <h2>Catálogo de Productos</h2>

            <div class="producto" data-id="UNGÜENTO AQUAPHOR BABY REPARADOR 85GMS"
                data-nombre="UNGÜENTO AQUAPHOR BABY REPARADOR 85GMS">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>01</span>
                </div>
                <img src="/img/item_1.jpg" alt="item_1" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>UNGÜENTO AQUAPHOR BABY REPARADOR 85GMS</strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="UNGÜENTO AQUAPHOR BABY REPARADOR 85GMS">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="UNGÜENTO AQUAPHOR BABY REPARADOR 85GMS">

                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR BABY REPARADOR 85GMS" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR BABY REPARADOR 85GMS" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR BABY REPARADOR 85GMS" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR BABY REPARADOR 85GMS" value="3"> 3
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 2 -->
            <div class="producto" data-id="UNGÜENTO AQUAPHOR REPARADOR TUBO 198GMS"
                data-nombre="UNGÜENTO AQUAPHOR REPARADOR TUBO 198GMS">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>02</span>
                </div>
                <img src="/img/item_2.jpg" alt="item_2" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>UNGÜENTO AQUAPHOR REPARADOR TUBO 198GMS</strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="UNGÜENTO AQUAPHOR REPARADOR TUBO 198GMS">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="UNGÜENTO AQUAPHOR REPARADOR TUBO 198GMS">

                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TUBO 198GMS" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TUBO 198GMS" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TUBO 198GMS" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TUBO 198GMS" value="3"> 3
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 3 -->
            <div class="producto" data-id="UNGÜENTO AQUAPHOR REPARADOR TARRO 396GMS"
                data-nombre="UNGÜENTO AQUAPHOR REPARADOR TARRO 396GMS">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>03</span>
                </div>
                <img src="/img/item_3.jpg" alt="item_3" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>UNGÜENTO AQUAPHOR REPARADOR TARRO 396GMS</strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="UNGÜENTO AQUAPHOR REPARADOR TARRO 396GMS">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="UNGÜENTO AQUAPHOR REPARADOR TARRO 396GMS">

                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TARRO 396GMS" value="0" checked>
                            0
                            cajas</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TARRO 396GMS" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TARRO 396GMS" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TARRO 396GMS" value="3"> 3
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 4 -->
            <div class="producto" data-id="UNGÜENTO AQUAPHOR REPARADOR TARRO 80GMS"
                data-nombre="UNGÜENTO AQUAPHOR REPARADOR TARRO 80GMS">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>04</span>
                </div>
                <img src="/img/item_4.jpg" alt="item_4" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>UNGÜENTO AQUAPHOR REPARADOR TARRO 80GMS </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="UNGÜENTO AQUAPHOR REPARADOR TARRO 80GMS">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 18 PIEZAS</span>
                    <div class="radios" data-radios="UNGÜENTO AQUAPHOR REPARADOR TARRO 80GMS">

                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TARRO 80GMS" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_UNGÜENTO AQUAPHOR REPARADOR TARRO 80GMS" value="1"> 1
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 5 -->
            <div class="producto" data-id="PROTECTOR SOLAR COPPERTONE 207ML"
                data-nombre="PROTECTOR SOLAR COPPERTONE 207ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>05</span>
                </div>
                <img src="/img/item_5.jpg" alt="item_5" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>PROTECTOR SOLAR COPPERTONE 207ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="PROTECTOR SOLAR COPPERTONE 207ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="PROTECTOR SOLAR COPPERTONE 207ML">

                        <label><input type="radio" name="p_PROTECTOR SOLAR COPPERTONE 207ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_PROTECTOR SOLAR COPPERTONE 207ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_PROTECTOR SOLAR COPPERTONE 207ML" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_PROTECTOR SOLAR COPPERTONE 207ML" value="3"> 3
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 6 -->
            <div class="producto" data-id="ACEITE EUCERIN DE DUCHA 200ML" data-nombre="ACEITE EUCERIN DE DUCHA 200ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>06</span>
                </div>
                <img src="/img/item_6.jpg" alt="item_6" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>ACEITE EUCERIN DE DUCHA 200ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="ACEITE EUCERIN DE DUCHA 200ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 6 PIEZAS</span>
                    <div class="radios" data-radios="ACEITE EUCERIN DE DUCHA 200ML">

                        <label><input type="radio" name="p_ACEITE EUCERIN DE DUCHA 200ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_ACEITE EUCERIN DE DUCHA 200ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_ACEITE EUCERIN DE DUCHA 200ML" value="2"> 2
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 7 -->
            <div class="producto" data-id="JABON EUCERIN BABY 400ML" data-nombre="JABON EUCERIN BABY 400ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>07</span>
                </div>
                <img src="/img/item_7.jpg" alt="item_7" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>JABON EUCERIN BABY 400ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="JABON EUCERIN BABY 400ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 6 PIEZAS</span>
                    <div class="radios" data-radios="JABON EUCERIN BABY 400ML">

                        <label><input type="radio" name="p_JABON EUCERIN BABY 400ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_JABON EUCERIN BABY 400ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_JABON EUCERIN BABY 400ML" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_JABON EUCERIN BABY 400ML" value="3"> 3
                            cajas</label>
                        <label><input type="radio" name="p_JABON EUCERIN BABY 400ML" value="4"> 4
                            cajas</label>
                        <label><input type="radio" name="p_JABON EUCERIN BABY 400ML" value="5"> 5
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 8 -->
            <div class="producto" data-id="CREMA EUCERIN ANTIPIGMENTO TUBO 75ML"
                data-nombre="CREMA EUCERIN ANTIPIGMENTO TUBO 75ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>08</span>
                </div>
                <img src="/img/item_8.jpg" alt="item_8" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA EUCERIN ANTIPIGMENTO TUBO 75ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA EUCERIN ANTIPIGMENTO TUBO 75ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA EUCERIN ANTIPIGMENTO TUBO 75ML">

                        <label><input type="radio" name="p_CREMA EUCERIN ANTIPIGMENTO TUBO 75ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA EUCERIN ANTIPIGMENTO TUBO 75ML" value="1"> 1
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 9 -->
            <div class="producto" data-id="CREMA EUCERIN ECZEMA BABY IN SHOWER 400ML"
                data-nombre="CREMA EUCERIN ECZEMA BABY IN SHOWER 400ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>09</span>
                </div>
                <img src="/img/item_9.jpg" alt="item_9" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA EUCERIN ECZEMA BABY IN SHOWER 400ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA EUCERIN ECZEMA BABY IN SHOWER 400ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA EUCERIN ECZEMA BABY IN SHOWER 400ML">

                        <label><input type="radio" name="p_CREMA EUCERIN ECZEMA BABY IN SHOWER 400ML" value="0" checked>
                            0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA EUCERIN ECZEMA BABY IN SHOWER 400ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA EUCERIN ECZEMA BABY IN SHOWER 400ML" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_CREMA EUCERIN ECZEMA BABY IN SHOWER 400ML" value="3"> 3
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 10 -->
            <div class="producto" data-id="CREMA EUCERIN SKIN BALANCE 48GMS"
                data-nombre="CREMA EUCERIN SKIN BALANCE 48GMS">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>10</span>
                </div>
                <img src="/img/item_10.jpg" alt="item_10" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA EUCERIN SKIN BALANCE 48GMS </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA EUCERIN SKIN BALANCE 48GMS">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA EUCERIN SKIN BALANCE 48GMS">

                        <label><input type="radio" name="p_CREMA EUCERIN SKIN BALANCE 48GMS" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA EUCERIN SKIN BALANCE 48GMS" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA EUCERIN SKIN BALANCE 48GMS" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_CREMA EUCERIN SKIN BALANCE 48GMS" value="3"> 3
                            cajas</label>
                        <label><input type="radio" name="p_CREMA EUCERIN SKIN BALANCE 48GMS" value="4"> 4
                            cajas</label>
                        <label><input type="radio" name="p_CREMA EUCERIN SKIN BALANCE 48GMS" value="5"> 5
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 11 -->
            <div class="producto" data-id="CREMA EUCERIN PIEL GRASA SPF50 75ML"
                data-nombre="CREMA EUCERIN PIEL GRASA SPF50 75ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>11</span>
                </div>
                <img src="/img/item_11.jpg" alt="item_11" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA EUCERIN PIEL GRASA SPF50 75ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA EUCERIN PIEL GRASA SPF50 75ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA EUCERIN PIEL GRASA SPF50 75ML">

                        <label><input type="radio" name="p_CREMA EUCERIN PIEL GRASA SPF50 75ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA EUCERIN PIEL GRASA SPF50 75ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA EUCERIN PIEL GRASA SPF50 75ML" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_CREMA EUCERIN PIEL GRASA SPF50 75ML" value="3"> 3
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 12 -->
            <div class="producto" data-id="DESODORANTE NIVEA MEN DEEP CARBON 50ML"
                data-nombre="DESODORANTE NIVEA MEN DEEP CARBON 50ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>12</span>
                </div>
                <img src="/img/item_12.jpg" alt="item_12" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>DESODORANTE NIVEA MEN DEEP CARBON 50ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="DESODORANTE NIVEA MEN DEEP CARBON 50ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="DESODORANTE NIVEA MEN DEEP CARBON 50ML">

                        <label><input type="radio" name="p_DESODORANTE NIVEA MEN DEEP CARBON 50ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_DESODORANTE NIVEA MEN DEEP CARBON 50ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_DESODORANTE NIVEA MEN DEEP CARBON 50ML" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_DESODORANTE NIVEA MEN DEEP CARBON 50ML" value="3"> 3
                            cajas</label>
                        <label><input type="radio" name="p_DESODORANTE NIVEA MEN DEEP CARBON 50ML" value="4"> 4
                            cajas</label>
                        <label><input type="radio" name="p_DESODORANTE NIVEA MEN DEEP CARBON 50ML" value="5"> 5
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 13 -->
            <div class="producto" data-id="DESODORANTE NIVEA DAMA TONO NATURAL 50ML"
                data-nombre="DESODORANTE NIVEA DAMA TONO NATURAL 50ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>13</span>
                </div>
                <img src="/img/item_13.jpg" alt="item_13" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>DESODORANTE NIVEA DAMA TONO NATURAL 50ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="DESODORANTE NIVEA DAMA TONO NATURAL 50ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="DESODORANTE NIVEA DAMA TONO NATURAL 50ML">

                        <label><input type="radio" name="p_DESODORANTE NIVEA DAMA TONO NATURAL 50ML" value="0" checked>
                            0
                            cajas</label>
                        <label><input type="radio" name="p_DESODORANTE NIVEA DAMA TONO NATURAL 50ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_DESODORANTE NIVEA DAMA TONO NATURAL 50ML" value="2"> 2
                            cajas</label>
                        <label><input type="radio" name="p_DESODORANTE NIVEA DAMA TONO NATURAL 50ML" value="3"> 3
                            cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 14 -->
            <div class="producto" data-id="GEL NIVEA MEN LIMPIADOR ALOE & VERA TUBO 125GMS"
                data-nombre="GEL NIVEA MEN LIMPIADOR ALOE & VERA TUBO 125GMS">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>14</span>
                </div>
                <img src="/img/item_14.jpg" alt="item_14" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>GEL NIVEA MEN LIMPIADOR ALOE & VERA TUBO 125GMS </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="GEL NIVEA MEN LIMPIADOR ALOE & VERA TUBO 125GMS">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="GEL NIVEA MEN LIMPIADOR ALOE & VERA TUBO 125GMS">

                        <label><input type="radio" name="p_GEL NIVEA MEN LIMPIADOR ALOE & VERA TUBO 125GMS" value="0"
                                checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_GEL NIVEA MEN LIMPIADOR ALOE & VERA TUBO 125GMS" value="1"> 1
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 15 -->
            <div class="producto" data-id="JABON NIVEA BOTANICAL BLOSSOM 591ML"
                data-nombre="JABON NIVEA BOTANICAL BLOSSOM 591ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>15</span>
                </div>
                <img src="/img/item_15.jpg" alt="item_15" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>JABON NIVEA BOTANICAL BLOSSOM 591ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="JABON NIVEA BOTANICAL BLOSSOM 591ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="JABON NIVEA BOTANICAL BLOSSOM 591ML">

                        <label><input type="radio" name="p_JABON NIVEA BOTANICAL BLOSSOM 591ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_JABON NIVEA BOTANICAL BLOSSOM 591ML" value="1"> 1
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 16 -->
            <div class="producto" data-id="JABON NIVEA IN MILK 250ML" data-nombre="JABON NIVEA IN MILK 250ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>16</span>
                </div>
                <img src="/img/item_16.jpg" alt="item_16" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>JABON NIVEA IN MILK 250ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="JABON NIVEA IN MILK 250ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="JABON NIVEA IN MILK 250ML">

                        <label><input type="radio" name="p_JABON NIVEA IN MILK 250ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_JABON NIVEA IN MILK 250ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_JABON NIVEA IN MILK 250ML" value="2"> 2
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 17 -->
            <div class="producto" data-id="JABON NIVEA MEN ACTIVE CLEAN 500ML"
                data-nombre="JABON NIVEA MEN ACTIVE CLEAN 500ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>17</span>
                </div>
                <img src="/img/item_17.jpg" alt="item_17" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>JABON NIVEA MEN ACTIVE CLEAN 500ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="JABON NIVEA MEN ACTIVE CLEAN 500ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 6 PIEZAS</span>
                    <div class="radios" data-radios="JABON NIVEA MEN ACTIVE CLEAN 500ML">

                        <label><input type="radio" name="p_JABON NIVEA MEN ACTIVE CLEAN 500ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_JABON NIVEA MEN ACTIVE CLEAN 500ML" value="1"> 1
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 18 -->
            <div class="producto" data-id="JABON NIVEA ROCK SALT 500ML" data-nombre="JABON NIVEA ROCK SALT 500ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>18</span>
                </div>
                <img src="/img/item_18.jpg" alt="item_18" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>JABON NIVEA ROCK SALT 500ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="JABON NIVEA ROCK SALT 500ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="JABON NIVEA ROCK SALT 500ML">

                        <label><input type="radio" name="p_JABON NIVEA ROCK SALT 500ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_JABON NIVEA ROCK SALT 500ML" value="1"> 1
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 19 -->
            <div class="producto" data-id="BALSAMO NIVEA HIDRA COLOR NUDE 4.8GMS"
                data-nombre="BALSAMO NIVEA HIDRA COLOR NUDE 4.8GMS">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>19</span>
                </div>
                <img src="/img/item_19.jpg" alt="item_19" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>BALSAMO NIVEA HIDRA COLOR NUDE 4.8GMS </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="BALSAMO NIVEA HIDRA COLOR NUDE 4.8GMS">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="BALSAMO NIVEA HIDRA COLOR NUDE 4.8GMS">

                        <label><input type="radio" name="p_BALSAMO NIVEA HIDRA COLOR NUDE 4.8GMS" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_BALSAMO NIVEA HIDRA COLOR NUDE 4.8GMS" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_BALSAMO NIVEA HIDRA COLOR NUDE 4.8GMS" value="2"> 2
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 20 -->
            <div class="producto" data-id="CREMA NIVEA LATA 50ML" data-nombre="CREMA NIVEA LATA 50ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>20</span>
                </div>
                <img src="/img/item_20.jpg" alt="item_20" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA NIVEA LATA 50ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA NIVEA LATA 50ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 60 PIEZAS</span>
                    <div class="radios" data-radios="CREMA NIVEA LATA 50ML">

                        <label><input type="radio" name="p_CREMA NIVEA LATA 50ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA NIVEA LATA 50ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA LATA 50ML" value="2"> 2
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 21 -->
            <div class="producto" data-id="CREMA NIVEA SOFT TARRO 500ML" data-nombre="CREMA NIVEA SOFT TARRO 500ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>21</span>
                </div>
                <img src="/img/item_21.jpg" alt="item_21" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA NIVEA SOFT TARRO 500ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA NIVEA SOFT TARRO 500ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA NIVEA SOFT TARRO 500ML">

                        <label><input type="radio" name="p_CREMA NIVEA SOFT TARRO 500ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA NIVEA SOFT TARRO 500ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA SOFT TARRO 500ML" value="2"> 2
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 22 -->
            <div class="producto" data-id="CREMA NIVEA FACIAL 5 NUTRITIVA 200ML"
                data-nombre="CREMA NIVEA FACIAL 5 NUTRITIVA 200ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>22</span>
                </div>
                <img src="/img/item_22.jpg" alt="item_22" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA NIVEA FACIAL 5 NUTRITIVA 200ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA NIVEA FACIAL 5 NUTRITIVA 200ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA NIVEA FACIAL 5 NUTRITIVA 200ML">

                        <label><input type="radio" name="p_CREMA NIVEA FACIAL 5 NUTRITIVA 200ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA NIVEA FACIAL 5 NUTRITIVA 200ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA FACIAL 5 NUTRITIVA 200ML" value="2"> 2
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 23 -->
            <div class="producto" data-id="CREMA NIVEA FACIAL 7 NUTRITIVA 375ML"
                data-nombre="CREMA NIVEA FACIAL 7 NUTRITIVA 375ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>23</span>
                </div>
                <img src="/img/item_23.jpg" alt="item_23" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA NIVEA FACIAL 7 NUTRITIVA 375ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA NIVEA FACIAL 7 NUTRITIVA 375ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA NIVEA FACIAL 7 NUTRITIVA 375ML">

                        <label><input type="radio" name="p_CREMA NIVEA FACIAL 7 NUTRITIVA 375ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA NIVEA FACIAL 7 NUTRITIVA 375ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA FACIAL 7 NUTRITIVA 375ML" value="2"> 2
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA FACIAL 7 NUTRITIVA 375ML" value="3"> 3
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 24 -->
            <div class="producto" data-id="CREMA NIVEA NUTRITIVA 1000ML" data-nombre="CREMA NIVEA NUTRITIVA 1000ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>24</span>
                </div>
                <img src="/img/item_24.jpg" alt="item_24" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA NIVEA NUTRITIVA 1000ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA NIVEA NUTRITIVA 1000ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 9 PIEZAS</span>
                    <div class="radios" data-radios="CREMA NIVEA NUTRITIVA 1000ML">

                        <label><input type="radio" name="p_CREMA NIVEA NUTRITIVA 1000ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA NIVEA NUTRITIVA 1000ML" value="1"> 1
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 25 -->
            <div class="producto" data-id="CREMA NIVEA MEN MAX HIDRATACION BOTELLA 500ML"
                data-nombre="CREMA NIVEA MEN MAX HIDRATACION BOTELLA 500ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>25</span>
                </div>
                <img src="/img/item_25.jpg" alt="item_25" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA NIVEA MEN MAX HIDRATACION BOTELLA 500ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA NIVEA MEN MAX HIDRATACION BOTELLA 500ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA NIVEA MEN MAX HIDRATACION BOTELLA 500ML">

                        <label><input type="radio" name="p_CREMA NIVEA MEN MAX HIDRATACION BOTELLA 500ML" value="0"
                                checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA NIVEA MEN MAX HIDRATACION BOTELLA 500ML" value="1"> 1
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 26 -->
            <div class="producto" data-id="CREMA NIVEA HIDRATACION EXPRESS 220ML"
                data-nombre="CREMA NIVEA HIDRATACION EXPRESS 220ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>26</span>
                </div>
                <img src="/img/item_26.jpg" alt="item_26" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA NIVEA HIDRATACION EXPRESS 220ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA NIVEA HIDRATACION EXPRESS 220ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA NIVEA HIDRATACION EXPRESS 220ML">

                        <label><input type="radio" name="p_CREMA NIVEA HIDRATACION EXPRESS 220ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA NIVEA HIDRATACION EXPRESS 220ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA HIDRATACION EXPRESS 220ML" value="2"> 2
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA HIDRATACION EXPRESS 220ML" value="3"> 3
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 27 -->
            <div class="producto" data-id="CREMA NIVEA PROTECCION SOLAR 100ML"
                data-nombre="CREMA NIVEA PROTECCION SOLAR 100ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>27</span>
                </div>
                <img src="/img/item_27.jpg" alt="item_27" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA NIVEA PROTECCION SOLAR 100ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA NIVEA PROTECCION SOLAR 100ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA NIVEA PROTECCION SOLAR 100ML">

                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="2"> 2
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="3"> 3
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="4"> 4
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="5"> 5
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="6"> 6
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="7"> 7
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="8"> 8
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="9"> 9
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 100ML" value="10"> 10
                            caja</label>
                    </div>
                </div>
            </div>

            <!-- Producto 28 -->
            <div class="producto" data-id="CREMA NIVEA PROTECCION SOLAR 220ML"
                data-nombre="CREMA NIVEA PROTECCION SOLAR 220ML">
                <div class="numero-producto-wrapper">
                    <span class="item-label">ITEM</span>
                    <span class="numero-producto" data-num>28</span>
                </div>
                <img src="/img/item_28.jpg" alt="item_28" />
                <div class="producto-info">
                    <div class="producto-titulo">
                        <strong>CREMA NIVEA PROTECCION SOLAR 220ML </strong>
                        <span class="badge-agotado" style="display:none"
                            data-badge="CREMA NIVEA PROTECCION SOLAR 220ML">Agotado</span>
                    </div>
                    <span style="color: red;">CAJA CON 12 PIEZAS</span>
                    <div class="radios" data-radios="CREMA NIVEA PROTECCION SOLAR 220ML">

                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 220ML" value="0" checked> 0
                            cajas</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 220ML" value="1"> 1
                            caja</label>
                        <label><input type="radio" name="p_CREMA NIVEA PROTECCION SOLAR 220ML" value="2"> 2
                            caja</label>
                    </div>
                </div>
            </div>

        </section>

        <section class="card" id="resumenPedido">
            <h2>Resumen del Pedido</h2>
            <div id="listaResumen">No hay productos seleccionados</div>
            <button id="btnEnviar">Enviar Pedido</button>
        </section>
    </main>

    <footer class="pie">
        ©️ 2025 Mi Tiendita – Venta Masiva |
        <a href="javascript:void(0)" onclick="mostrarAviso()">Aviso de Privacidad</a>
    </footer>

    <div class="modal" id="modalAviso">
        <div class="modal-content">
            <button class="btn btn-gray"
                onclick="document.getElementById('modalAviso').style.display='none'">Cerrar</button>
            <h3>Aviso de Privacidad</h3>
            <pre id="contenidoAviso" style="white-space:pre-line;font-family:inherit;"></pre>
        </div>
    </div>

    <div class="modal" id="modalEmpleado">
        <div class="modal-content" style="max-width:520px">
            <h3 style="text-align:center;color:var(--azul);font-weight:800;margin-top:0">Información del Empleado</h3>
            <label><b>Nómina</b> <span class="req">*</span></label>
            <input type="text" id="m_nomina" placeholder="Ingresa tu nómina" />

            <label><b>Nombre</b></label>
            <input type="text" id="m_nombre" placeholder="Se llenará automáticamente" disabled style="color:#000;" />

            <label><b>Número Celular</b> <span class="req">*</span></label>
            <input type="tel" id="m_celular" placeholder="10 dígitos" maxlength="10" />

            <div id="errorNomina" style="color:#c00;font-size:14px;font-weight:600;margin:8px 0 0;display:none;"></div>

            <div class="modal-actions" style="justify-content:center">
                <button class="btn btn-green" id="btnModalAceptar">ACEPTAR</button>
            </div>
        </div>
    </div>

    <div class="modal" id="modalPreConfirm">
        <div class="modal-content" style="max-width:520px">
            <h3 style="text-align:center">
                ¿Estas seguro de continuar con <br>
                la confirmación de tu pedido?
            </h3>
            <div class="modal-actions center">
                <button class="btn btn-green" id="btnPreSi">SI</button>
                <button class="btn btn-red" id="btnPreNo">NO</button>
            </div>

        </div>
    </div>

    <div class="modal" id="modalConfirmacion">
        <div class="modal-content">
            <div class="confirm-grid">
                <div>
                    <span style="color: #0d1c84;">
                        <h3>Confirmar Pedido</h3>
                    </span>
                    <div id="detallePedido"></div>
                    <div class="total" id="totalPopup"></div>
                </div>
                <div class="folio-box">
                    <b>FOLIO</b>
                    <div class="folio-num" id="folioNum">—</div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-gray" id="btnCancelarPop">Cancelar</button>
                <button class="btn btn-green" id="btnConfirmarPop">Confirmar Pedido</button>
            </div>
        </div>
    </div>

    <script>
        firebase.initializeApp({
            apiKey: "AIzaSyDvHy46iATTlnwpOgWgSib2Tm43SJPkjzY",
            authDomain: "registrotienditabmm.firebaseapp.com",
            projectId: "registrotienditabmm"
        });
        const db = firebase.firestore();

        async function verificarBloqueoAntesDeConfirmar(nomina) {
            const docRef = db.collection("bloqueados").doc(nomina.toString());
            const docSnap = await docRef.get();

            if (docSnap.exists) {
                const data = docSnap.data();
                if (data.motivo === "Se agotó el tiempo de compra") {
                    const btn = document.getElementById("btnConfirmarPop");
                    if (btn) {
                        btn.disabled = true;
                        btn.style.background = "#ccc";
                        btn.style.cursor = "not-allowed";
                    }

                    alert("⛔ Se agotó el tiempo de compra. Debes ingresar de nuevo.");

                    document.getElementById("modalConfirmacion").style.display = "none";
                    document.getElementById("modalEmpleado").style.display = "flex";

                    setTimeout(() => location.reload(), 250);

                    return true;
                }
            }
            return false;
        }

        const EXT_URL = "https://script.google.com/macros/s/AKfycbzgMKRaneoWHg4OoBaYIEN04p74LPvNLY0lWfrvRTMvHhRBMnu0_NmckAg10xwEsQ9QIA/exec";
        const DURACION_MS = 10 * 60 * 1000;

        const productosEls = [...document.querySelectorAll('.producto')];
        const CATALOGO = {};
        const listaResumen = document.getElementById('listaResumen');
        const bannerEstado = document.getElementById('bannerEstado');
        const timerEl = document.getElementById('cuentaRegresiva');
        const timerFloat = document.getElementById('timerFloat');
        const timerFloatText = document.getElementById('timerFloatText');

        const vNomina = document.getElementById('vNomina');
        const vNombre = document.getElementById('vNombre');
        const vCelular = document.getElementById('vCelular');

        const modalEmpleado = document.getElementById('modalEmpleado');
        const m_nomina = document.getElementById('m_nomina');
        const m_nombre = document.getElementById('m_nombre');
        const m_celular = document.getElementById('m_celular');
        const errorNomina = document.getElementById('errorNomina');

        let isModalOpen = false;
        let pushedStateForModal = false;
        let ventanaFin = null;
        let folioActual = null;

        function setBanner(type, msg) {
            bannerEstado.className = `banner ${type}`;
            bannerEstado.textContent = msg;
            bannerEstado.style.display = msg ? 'block' : 'none';
        }

        const getCantidad = (id) => {
            const radios = document.querySelectorAll(`[data-radios="${CSS.escape(id)}"] input[type="radio"]`);
            const r = [...radios].find(x => x.checked);
            return parseInt(r?.value || 0);
        };
        const setCantidad = (id, val) => {
            const radios = document.querySelectorAll(`[data-radios="${CSS.escape(id)}"] input[type="radio"]`);
            [...radios].forEach(r => r.checked = (parseInt(r.value) === val));
        };
        const maxRadioFor = (id) => {
            const radios = document.querySelectorAll(`[data-radios="${CSS.escape(id)}"] input[type="radio"]`);
            let m = 0;[...radios].forEach(r => { const v = parseInt(r.value); if (Number.isFinite(v)) m = Math.max(m, v); });
            return m;
        };
        const maxPrecioFor = (id) => {
            const precios = CATALOGO[id]?.precios || {};
            const ks = Object.keys(precios).map(k => parseInt(k)).filter(Number.isFinite);
            return ks.length ? Math.max(...ks) : 0;
        };

        function actualizarResumen() {
            const lineas = productosEls
                .map(el => {
                    const id = el.dataset.id, n = el.dataset.nombre, c = getCantidad(id);
                    return c > 0 ? `${n} x ${c}` : null;
                })
                .filter(Boolean);
            listaResumen.innerHTML = lineas.length ? `<p>${lineas.join('</p><p>')}</p>` : 'No hay productos seleccionados';
        }

        async function cargarNomina(nomina) {
            if (!nomina) return { exists: false };

            const [s, bloqueadoSnap] = await Promise.all([
                db.doc(`nominas/${nomina}`).get(),
                db.doc(`bloqueados/${nomina}`).get()
            ]);

            if (bloqueadoSnap.exists) {
                return { exists: false, bloqueado: true, motivo: bloqueadoSnap.data()?.motivo || 'Bloqueado' };
            }

            if (!s.exists) return { exists: false };

            const d = s.data();
            return { exists: true, nombre: d?.nombre || '', correo: d?.correo || '' };
        }

        function keyTimer(nomina) { return `timer_end_${nomina}`; }
        function mostrarTimer(show) {
            timerEl.style.display = show ? 'block' : 'none';
            timerFloat.style.display = show ? 'block' : 'none';
        }
        function iniciarTimer10Min(nomina) {
            const finMs = Date.now() + DURACION_MS;
            ventanaFin = new Date(finMs);
            sessionStorage.setItem(keyTimer(nomina), String(finMs));
            mostrarTimer(true);
            actualizarCuenta();
            if (window._tmr) clearInterval(window._tmr);
            window._tmr = setInterval(actualizarCuenta, 1000);
        }
        function restaurarTimerSiExiste(nomina) {
            const raw = sessionStorage.getItem(keyTimer(nomina));
            if (!raw) return false;
            const ts = parseInt(raw);
            if (Number.isFinite(ts) && ts > Date.now()) {
                ventanaFin = new Date(ts);
                mostrarTimer(true);
                if (window._tmr) clearInterval(window._tmr);
                window._tmr = setInterval(actualizarCuenta, 1000);
                actualizarCuenta();
                return true;
            }
            sessionStorage.removeItem('reload_reason');
            return false;
        }
        function actualizarCuenta() {
            if (!ventanaFin) { mostrarTimer(false); return; }
            const left = Math.max(0, Math.floor((ventanaFin - new Date()) / 1000));
            const mm = String(Math.floor(left / 60)).padStart(2, '0');
            const ss = String(left % 60).padStart(2, '0');
            timerEl.textContent = `Tiempo restante: ${mm}:${ss}`;
            timerFloatText.textContent = `${mm}:${ss}`;
            if (left <= 0) {
                clearInterval(window._tmr); window._tmr = null;
                mostrarTimer(false);
                setBanner('error', 'Tu ventana de compra ha expirado.');
                document.getElementById('btnEnviar').disabled = true;

                const nomina = vNomina.textContent || '';
                if (nomina) {
                    db.doc(`bloqueados/${nomina}`).set({
                        fecha: firebase.firestore.FieldValue.serverTimestamp(),
                        motivo: 'Se agotó el tiempo de compra'
                    }, { merge: true })
                        .then(() => {
                            sessionStorage.setItem('reload_reason', 'timeout');
                            setTimeout(() => location.reload(), 250);
                        })
                        .catch(err => {
                            console.error("Error al bloquear nómina:", err);
                            alert("No se pudo registrar el bloqueo. Intenta de nuevo.");
                        });
                }

            }

        }

        async function cargarCatalogoYStock() {
            productosEls.forEach((el, idx) => {
                const numEl = el.querySelector('[data-num]');
                if (numEl) numEl.textContent = String(idx + 1).padStart(2, '0');
            });

            await Promise.all(productosEls.map(async el => {
                const id = el.dataset.id;
                const nombre = el.dataset.nombre;
                const [catSnap, stockSnap] = await Promise.all([
                    db.doc(`catalogo/${id}`).get(),
                    db.doc(`stock/${id}`).get()
                ]);
                if (!catSnap.exists || !stockSnap.exists) {
                    el.remove();
                    return;
                }
                const precios = catSnap.data()?.precios ?? {};
                const stock = Number(stockSnap.data()?.disponible ?? 0);

                if (stock <= 0) {
                    el.remove();
                    return;
                }

                CATALOGO[id] = { precios, stock, nombre };

                const radiosWrap = el.querySelector(`[data-radios="${CSS.escape(id)}"]`);
                if (radiosWrap) {
                    const labels = [...radiosWrap.querySelectorAll('label')];
                    labels.forEach(l => {
                        const r = l.querySelector('input[type="radio"]');
                        const v = parseInt(r?.value || 0);
                        if (v > 0 && (v > stock || CATALOGO[id].precios[String(v)] == null)) {
                            l.remove();
                        }
                    });
                }
            }));
        }

        function construirDraftDeSeleccion() {
            const items = [];
            for (const el of document.querySelectorAll('.producto')) {
                const id = el.dataset.id, n = el.dataset.nombre, c = getCantidad(id);
                if (c > 0) {
                    const precios = CATALOGO[id]?.precios || {};
                    const s = Number(precios[String(c)] || 0);
                    items.push({ id, nombre: n, c, s });
                }
            }
            return items;
        }

        function renderPopup(items) {
            items.forEach(it => {
                const precios = CATALOGO[it.id]?.precios || {};
                it.s = Number(precios[String(it.c)] || 0);
            });
            const total = items.reduce((a, b) => a + Number(b.s || 0), 0);

            const cont = document.getElementById('detallePedido');

            const nomina = vNomina.textContent || '';
            const nombre = vNombre.textContent || '';
            const celular = vCelular.textContent || '';

            const htmlLineas = items.length ? items.map((it, i) => {
                const radiosMax = maxRadioFor(it.id);
                const precioMax = maxPrecioFor(it.id);
                const stockDisponible = CATALOGO[it.id]?.stock ?? 0;
                const allowedMax = stockDisponible > 0
                    ? Math.min(stockDisponible, precioMax, radiosMax)
                    : 0;
                if (it.c > allowedMax) { it.c = allowedMax; }

                if (allowedMax === 0) {
                    return `
                    <div class="linea">
                        <div style="flex:1">
                        <small><b>${it.nombre}</b></small>
                        </div>
                        <span style="color:red;font-weight:700">Producto agotado</span>
                        <button class="quitar" data-idx="${i}">Eliminar</button>
                    </div>
                    `;
                }

                const opciones = Array.from({ length: allowedMax }, (_, q) => {
                    const val = q + 1;
                    const sel = val === it.c ? 'selected' : '';
                    return `<option value="${val}" ${sel}>${val}</option>`;
                }).join('');

                return `
                <div class="linea">
                    <div style="flex:1">
                    <small><b>${it.nombre}</b></small>
                    </div>
                    <div>
                    <label style="font-size:12px;display:block;margin-bottom:2px">Cantidad</label>
                    <select data-idx="${i}" class="sel-ajuste">${opciones}</select>
                    </div>
                    <button class="quitar" data-idx="${i}">Eliminar</button>
                </div>
                `;

            }).join('') : '<p><i>Sin productos</i></p>';

            cont.innerHTML = `
                <div style="margin-bottom:10px">
                <div><b>Nómina:</b> ${nomina}</div>
                <div><b>Nombre:</b> ${nombre}</div>
                <div><b>Celular:</b> ${celular}</div>
                </div>
                <div><span style="color: #0d1c84;"><b>Productos Seleccionados:</b></span></div>
                ${htmlLineas}
            `;
            document.getElementById('totalPopup').innerHTML = `
                <span class="label">Total:</span>
                <span class="amount">$${total.toLocaleString()} MXN</span>
            `;

            cont.querySelectorAll('.quitar').forEach(btn => {
                btn.onclick = () => {
                    const idx = parseInt(btn.dataset.idx);
                    items.splice(idx, 1);
                    renderPopup(items);
                    actualizarResumen();
                };
            });
            cont.querySelectorAll('.sel-ajuste').forEach(sel => {
                sel.onchange = (e) => {
                    const idx = parseInt(sel.dataset.idx);
                    const nuevo = parseInt(e.target.value);
                    const it = items[idx];
                    it.c = nuevo;
                    setCantidad(it.id, nuevo);
                    renderPopup(items);
                    actualizarResumen();
                };
            });

            const hayAlgo = items.some(it => it.c > 0);
            document.getElementById('btnConfirmarPop').disabled = !hayAlgo;
        }

        async function generarFolioConsecutivo(nomina, nombre) {
            const counterRef = db.doc('counters/folios');
            return db.runTransaction(async (tx) => {
                const snap = await tx.get(counterRef);
                let seq = 0;
                if (snap.exists && Number.isFinite(snap.data().seq)) {
                    seq = Number(snap.data().seq);
                }
                const next = seq + 1;
                tx.set(counterRef, { seq: next }, { merge: true });
                tx.set(db.doc(`folios/${next}`), {
                    folio: next,
                    nomina: nomina || '',
                    nombre: nombre || '',
                    fecha: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                return next;
            });
        }

        function enviarPedido(folio, items) {
            const productosStr = items
                .filter(i => i.c > 0)
                .map(i => `${i.nombre} x ${i.c}=${i.s}`)
                .join(',');
            fetch(EXT_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: new URLSearchParams({
                    tipo: 'Interno',
                    folio: String(folio),
                    nomina: vNomina.textContent || '',
                    Nombre: vNombre.textContent || '',
                    Celular: vCelular.textContent || '',
                    Productos: productosStr
                })
            });
        }

        function beforeUnloadHandler(e) {
            const reason = sessionStorage.getItem('reload_reason');
            if (reason === 'timeout') {
                return;
            }

            if (isModalOpen && (vNomina.textContent && vNomina.textContent !== '—')) {
                e.preventDefault();
                e.returnValue = '';
            }
        }

        function attachBeforeUnload() { window.addEventListener('beforeunload', beforeUnloadHandler); }
        function detachBeforeUnload() { window.removeEventListener('beforeunload', beforeUnloadHandler); }
        window.addEventListener('pagehide', () => {
            const reason = sessionStorage.getItem('reload_reason');
            if (reason === 'timeout') {
                return;
            }
            if (isModalOpen) {
                const n = vNomina.textContent;
                if (n) {
                    try {
                        localStorage.setItem('blocked_due_to_reload_nomina', n);
                    } catch (_) { }
                    modalEmpleado.style.display = 'flex';
                    lockScroll();
                }
            }
        });



        async function aplicarBloqueoDiferidoSiExiste() {
            const markedNomina = localStorage.getItem('blocked_due_to_reload_nomina');
            if (!markedNomina) return;
            localStorage.removeItem('blocked_due_to_reload_nomina');
            try {
                await db.doc(`bloqueados/${markedNomina}`).set({
                    fecha: firebase.firestore.FieldValue.serverTimestamp(),
                    motivo: 'Recargó la página durante confirmación'
                }, { merge: true });
                alert('Tu nómina fue bloqueada por recargar la página.');
                localStorage.setItem('blocked_reason_reload_nomina', markedNomina);
            } catch (_) { }
        }

        document.addEventListener('keydown', (e) => {
            if (!isModalOpen) return;
            const isReloadKey = (e.key === 'F5') || ((e.ctrlKey || e.metaKey) && (e.key === 'r' || e.key === 'R'));
            if (!isReloadKey) return;
            e.preventDefault();
            const n = vNomina.textContent;
            if (!n) return;
            const ok = confirm('Si recarga la página se bloqueará tu nómina y no podrás comprar. ¿Deseas continuar?');
            if (ok) {
                try { localStorage.setItem('blocked_due_to_reload_nomina', n); } catch (_) { }
                setTimeout(() => location.reload(), 250);
            }
            else {
                alert('Has cancelado la recarga. Puedes continuar con tu confirmación.');
            }
        });

        window.addEventListener('popstate', async () => {
            if (!isModalOpen) return;
            const n = vNomina.textContent;
            if (!n) return;

            const ok = confirm('Si regresa o recarga, se bloqueará su nómina y ya no podrá realizar su compra. ¿Desea continuar?');
            if (ok) {
                try {
                    await db.doc(`bloqueados/${n}`).set({
                        fecha: firebase.firestore.FieldValue.serverTimestamp(),
                        motivo: 'Abandonó la confirmación con botón Volver'
                    }, { merge: true });
                } catch (_) { }

                document.getElementById('modalConfirmacion').style.display = 'none';
                isModalOpen = false;
                detachBeforeUnload();

                modalEmpleado.style.display = 'flex';
                lockScroll();

                alert('Tu nómina ha sido bloqueada.');
                setTimeout(() => location.reload(), 250);
            }
        });

        m_celular.addEventListener('input', function () {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
        });

        m_nomina.addEventListener('input', async () => {
            const n = m_nomina.value.trim();

            if (!n) {
                m_nombre.value = '';
                errorNomina.style.display = 'none';
                m_nomina.classList.remove('error');
                return;
            }

            const info = await cargarNomina(n);

            if (info.exists) {
                m_nombre.value = info.nombre || '';
                errorNomina.style.display = 'none';
                m_nomina.classList.remove('error');
            } else if (info.bloqueado) {
                m_nombre.value = '';
                errorNomina.textContent = `⛔ ${info.motivo}`;
                errorNomina.style.display = 'block';
                m_nomina.classList.add('error');
            } else {
                m_nombre.value = '';
                errorNomina.textContent = 'Este número de nómina no está registrado';
                errorNomina.style.display = 'block';
                m_nomina.classList.add('error');
            }
        });

        document.getElementById('btnModalAceptar').addEventListener('click', async () => {
            const nomina = m_nomina.value.trim();

            const infoNom = await cargarNomina(nomina);
            if (!infoNom.exists) {
                errorNomina.textContent = 'Este número de nómina no está registrado';
                errorNomina.style.display = 'block';
                m_nomina.classList.add('error');
                return;
            } else {                
                if (!m_nombre.value.trim()) m_nombre.value = infoNom.nombre || '';
                errorNomina.style.display = 'none';
                m_nomina.classList.remove('error');
            }

            const nombre = m_nombre.value.trim();
            const celular = m_celular.value.trim();
           
            let ok = true, errs = [];
            const mark = (el, bad) => el.classList.toggle('error', bad);
            mark(m_nomina, !nomina); if (!nomina) { ok = false; errs.push('La nómina es obligatoria.'); }
            mark(m_nombre, !nombre); if (!nombre) { ok = false; errs.push('El nombre es obligatorio.'); }
            mark(m_celular, !/^\d{10}$/.test(celular)); if (!/^\d{10}$/.test(celular)) { ok = false; errs.push('El celular debe tener 10 dígitos.'); }
            if (!ok) { alert('Corrige:\n\n' + errs.join('\n')); return; }
            
            vNomina.textContent = nomina;
            vNombre.textContent = nombre;
            vCelular.textContent = celular;

            if (!restaurarTimerSiExiste(nomina)) {
                iniciarTimer10Min(nomina);
            }

            modalEmpleado.style.display = 'none';
            unlockScroll();
        });

        document.getElementById('btnEnviar').addEventListener('click', () => {            
            const nomina = vNomina.textContent;
            const nombre = vNombre.textContent;
            const celular = vCelular.textContent;

            let ok = true, errs = [];
            if (!nomina || nomina === '—') { ok = false; errs.push('Falta nómina (abre el formulario y acepta).'); }
            if (!nombre || nombre === '—') { ok = false; errs.push('Falta nombre.'); }
            if (!/^\d{10}$/.test(celular || '')) { ok = false; errs.push('El celular debe tener 10 dígitos.'); }

            const hay = [...document.querySelectorAll('.producto')].some(el => getCantidad(el.dataset.id) > 0);
            if (!hay) { ok = false; errs.push('Debes seleccionar al menos 1 caja.'); }

            if (!ok) { alert('Corrige:\n\n' + errs.join('\n')); return; }
            
            document.getElementById('modalPreConfirm').style.display = 'flex';
        });
        
        document.getElementById('btnPreNo').addEventListener('click', () => {
            document.getElementById('modalPreConfirm').style.display = 'none';
        });
        
        document.getElementById('btnPreSi').addEventListener('click', async () => {
            document.getElementById('modalPreConfirm').style.display = 'none';

            const draft = construirDraftDeSeleccion();
            const nomina = vNomina.textContent || '';
            const nombre = vNombre.textContent || '';
            try {
                folioActual = await generarFolioConsecutivo(nomina, nombre);
            } catch (e) {
                alert('No se pudo generar el folio. Intenta de nuevo.');
                return;
            }
            document.getElementById('folioNum').textContent = String(folioActual);

            renderPopup(draft);
            document.getElementById('modalConfirmacion').style.display = 'flex';
            isModalOpen = true;
            attachBeforeUnload();
            try { history.pushState({ modalOpen: true }, ''); pushedStateForModal = true; } catch (_) { }
        });

        function ajustarStockVisual(draft, lecturas) {
            lecturas.forEach(({ it, disp }) => {
                if (CATALOGO[it.id]) {
                    CATALOGO[it.id].stock = disp;
                }

                if (disp < it.c) {
                    it.c = Math.max(0, disp);

                    setCantidad(it.id, it.c);
                    
                    const badge = document.querySelector(`[data-badge="${CSS.escape(it.id)}"]`);
                    if (disp === 0 && badge) badge.style.display = "inline-block";

                    if (disp === 0) {
                        const lineas = document.querySelectorAll(`#detallePedido .linea`);
                        lineas.forEach(l => {
                            if (l.innerHTML.includes(it.nombre)) {
                                l.querySelector("select")?.remove();
                                const msg = document.createElement("span");
                                msg.textContent = "Producto agotado, eliminarlo";
                                msg.style.color = "red";
                                msg.style.fontWeight = "700";
                                l.insertBefore(msg, l.querySelector(".quitar"));
                            }
                        });
                    }
                }
            });
        }

        document.getElementById('btnConfirmarPop').addEventListener('click', async () => {
            const nomina = vNomina.textContent || '';
            
            const bloqueado = await verificarBloqueoAntesDeConfirmar(nomina);
            if (bloqueado) return; 

            const draft = construirDraftDeSeleccion();
            if (draft.length === 0) {
                alert('No hay productos en el pedido.');
                return;
            }
            
            const agotados = draft.filter(it => {
                const stockDisponible = CATALOGO[it.id]?.stock ?? 0;
                return stockDisponible <= 0; 
            });

            if (agotados.length > 0) {
                alert("⚠️ Debes eliminar los productos agotados antes de confirmar tu pedido.");
                return; 
            }

            try {
                const nomina = vNomina.textContent || '';
                
                const result = await db.runTransaction(async tx => {
                    
                    const lecturas = await Promise.all(draft.map(async it => {
                        const ref = db.doc(`stock/${it.id}`);
                        const snap = await tx.get(ref);
                        return { it, ref, disp: Number(snap.data()?.disponible || 0) };
                    }));
                    let huboAjustes = false;
                    for (const { it, disp } of lecturas) {
                        if (disp < it.c) {
                            huboAjustes = true;
                        }
                    }

                    if (huboAjustes) {
                        ajustarStockVisual(draft, lecturas);
                        renderPopup(draft);
                        return { ok: false, msg: "⚠️ Algunos productos fueron ajustados por falta de stock. Revisa de nuevo tu pedido." };
                    }

                    lecturas.forEach(({ it, ref, disp }) => {
                        tx.update(ref, { disponible: disp - it.c });
                    });
                    
                    if (nomina) {
                        tx.set(db.doc(`bloqueados/${nomina}`), {
                            fecha: firebase.firestore.FieldValue.serverTimestamp(),
                            motivo: 'Confirmó pedido'
                        }, { merge: true });
                    }
                    return { ok: true };
                });

                if (!result.ok) {
                    alert(result.msg || 'No se pudo confirmar.');
                    return;
                }

                enviarPedido(folioActual, draft.filter(i => i.c > 0));
                document.getElementById('modalConfirmacion').style.display = 'none';
                isModalOpen = false;
                detachBeforeUnload();
                if (pushedStateForModal) { try { history.back(); } catch (_) { } pushedStateForModal = false; }
                alert('✅ Tu pedido se ha guardado exitosamente.');
                setTimeout(() => location.href = '/gracias/', 250);
            } catch (e) {
                alert('⚠️ ' + (e.message || 'Error al confirmar'));
            }
        });
        
        document.getElementById('btnCancelarPop').addEventListener('click', async () => {
            const n = vNomina.textContent;
            if (!n) { alert('Falta número de nómina.'); return; }

            if (confirm('Si cancelas, se bloqueará tu nómina y no podrás generar otra compra. ¿Deseas continuar?')) {
                await db.doc(`bloqueados/${n}`).set({
                    fecha: firebase.firestore.FieldValue.serverTimestamp(),
                    motivo: 'Canceló el pedido'
                }, { merge: true });

                document.getElementById('modalConfirmacion').style.display = 'none';
                isModalOpen = false;
                detachBeforeUnload();
                
                modalEmpleado.style.display = 'flex';
                lockScroll();

                alert('Se canceló y tu nómina ha sido bloqueada.');
                setTimeout(() => location.reload(), 250);

            }
        });

        function mostrarAviso() {
            fetch('/docs/aviso.txt')
                .then(r => { if (!r.ok) throw 0; return r.text(); })
                .then(t => { document.getElementById('contenidoAviso').textContent = t; document.getElementById('modalAviso').style.display = 'flex'; })
                .catch(_ => { document.getElementById('contenidoAviso').textContent = 'No se pudo cargar el aviso.'; document.getElementById('modalAviso').style.display = 'flex'; });
        }
        window.mostrarAviso = mostrarAviso;

        let __scrollY = 0;
        function lockScroll() {
            __scrollY = window.scrollY || document.documentElement.scrollTop || 0;
            document.documentElement.classList.add('modal-open');
            document.body.classList.add('modal-open');
            document.body.style.position = 'fixed';
            document.body.style.top = `-${__scrollY}px`;
            document.body.style.left = '0';
            document.body.style.right = '0';
            document.body.style.width = '100%';
        }

        function unlockScroll() {
            document.documentElement.classList.remove('modal-open');
            document.body.classList.remove('modal-open');
            document.body.style.position = '';
            document.body.style.top = '';
            document.body.style.left = '';
            document.body.style.right = '';
            document.body.style.width = '';
            window.scrollTo(0, __scrollY);
        }

        (async () => {
            try {
                await aplicarBloqueoDiferidoSiExiste();
                await cargarCatalogoYStock();
                actualizarResumen();
                modalEmpleado.style.display = 'flex';
                document.body.classList.add('modal-open');
                lockScroll();
            } catch (e) {
                alert('Config de catálogo/stock incompleta: ' + (e.message || e));
            }
        })();

        document.addEventListener('change', (ev) => {
            if (ev.target && ev.target.matches('input[type="radio"]')) {
                actualizarResumen();
            }
        });
    </script>
</body>

</html>
